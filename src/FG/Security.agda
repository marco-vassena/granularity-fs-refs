-- This module proves security of FG, i.e., termination-insensitive
-- non-interference (TINI).  The proof consists in showing that the
-- big-step semantics preserves L-equivalence.
--
-- This module is parametric in the security lattice ğ‘³ = (ğ“›, âŠ‘) and in
-- the attacker's security A âˆˆ ğ“›.

open import Lattice hiding (_â‰Ÿ_)

module FG.Security {{ğ‘³ : Lattice}} (A : Label) where

open import FG.Types hiding (_Ã—_) renaming (_âŠ†_ to _âŠ†á¶œ_) hiding (refl-âŠ†)
open import FG.Syntax hiding (_âˆ˜_ )
open import FG.Semantics
open import FG.LowEq A public

open import Data.Empty
open import Relation.Binary.PropositionalEquality
open import Relation.Nullary
open import Generic.Bijection as B hiding (_âˆˆ_)

import Generic.Store.LowEq {Ty} {Raw} _â‰ˆâŸ¨_âŸ©á´¿_ as S

--------------------------------------------------------------------------------
-- TODO: move this to.FG LowEq module?
-- Lemmas on L-equivalent environments.

-- Lookup in L-equivalent envs gives L-equivalent values
lookup-â‰ˆâ±½ : âˆ€ {Ï„ Î“ Î¸â‚ Î¸â‚‚ Î²} â†’ (Ï„âˆˆÎ“ : Ï„ âˆˆ Î“) â†’
              Î¸â‚ â‰ˆâŸ¨ Î² âŸ©á´± Î¸â‚‚ â†’ (Î¸â‚ !! Ï„âˆˆÎ“) â‰ˆâŸ¨ Î² âŸ©â±½ (Î¸â‚‚ !! Ï„âˆˆÎ“)
lookup-â‰ˆâ±½ here (vâ‚â‰ˆvâ‚‚ âˆ· Î¸â‚â‰ˆÎ¸â‚‚) = vâ‚â‰ˆvâ‚‚
lookup-â‰ˆâ±½ (there Ï„âˆˆÎ“) (vâ‚â‰ˆvâ‚‚ âˆ· Î¸â‚â‰ˆÎ¸â‚‚) = lookup-â‰ˆâ±½ Ï„âˆˆÎ“ Î¸â‚â‰ˆÎ¸â‚‚


-- Slicing L-equivalent envs gives gives L-equivalent envs.
slice-â‰ˆá´± : âˆ€ {Î“â‚ Î“â‚‚ Î²} {Î¸â‚ Î¸â‚‚ : Env Î“â‚‚} â†’
                 Î¸â‚ â‰ˆâŸ¨ Î² âŸ©á´± Î¸â‚‚ â†’
                 (Î“â‚âŠ†Î“â‚‚ : Î“â‚ âŠ†á¶œ Î“â‚‚) â†’
                 slice Î¸â‚ Î“â‚âŠ†Î“â‚‚ â‰ˆâŸ¨ Î² âŸ©á´± slice Î¸â‚‚ Î“â‚âŠ†Î“â‚‚
slice-â‰ˆá´± [] base = []
slice-â‰ˆá´± (vâ‚â‰ˆvâ‚‚ âˆ· Î¸â‚â‰ˆÎ¸â‚‚) (cons p) = vâ‚â‰ˆvâ‚‚ âˆ· slice-â‰ˆá´± Î¸â‚â‰ˆÎ¸â‚‚ p
slice-â‰ˆá´± (vâ‚â‰ˆvâ‚‚ âˆ· Î¸â‚â‰ˆÎ¸â‚‚) (drop p) = slice-â‰ˆá´± Î¸â‚â‰ˆÎ¸â‚‚ p

--------------------------------------------------------------------------------

open import Data.Product renaming (_,_ to _âˆ§_) hiding (,_)

open import FG.Valid

open Conf
open import Data.Nat hiding (_^_)
open import Data.Nat.Properties

import Generic.Heap.Lemmas Ty Value as H

-- TODO: trans-â‹¤ (join-âŠ‘ ...) proofs are simplified by join-â‹¤â‚

-- TODO: rename high step
step-â‰ˆá´´ : âˆ€ {Ï„ Î“ Î¸ pc} {c : IConf Î“ Ï„} {c' : FConf Ï„} â†’
             let âŸ¨ Î£ , Î¼ , _ âŸ© = c
                 âŸ¨ Î£' , Î¼' , _ âŸ© = c' in
                {{validá´¾ : Validá´¾ âŸ¨ Î£ , Î¼ âŸ© }} {{validá´± : Validá´± âˆ¥ Î¼ âˆ¥á´´ Î¸}} â†’
               c â‡“âŸ¨ Î¸ , pc âŸ© c' â†’
               pc â‹¤ A â†’
               âŸ¨ Î£ , Î¼ âŸ© â‰ˆâŸ¨ Î¹ âˆ¥ Î¼ âˆ¥á´´ âŸ©á´¾ âŸ¨ Î£' , Î¼' âŸ©
-- TODO: helper data type? we probably always apply the same operations.
step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Var Ï„âˆˆÎ“ x) pcâ‹¤A = refl-â‰ˆá´¾ {{isVá´¾}}
step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} Unit pcâ‹¤A = refl-â‰ˆá´¾ {{isVá´¾}}
step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Lbl â„“) pcâ‹¤A = refl-â‰ˆá´¾ {{isVá´¾}}

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Testâ‚ x xâ‚ â„“âŠ‘ refl) pcâ‹¤A =
  let isVá´± âˆ§ isVá´¾â€² âˆ§ isVâ‚‚â€² = valid-invariant x âŸ¨ isVá´¾ , isVâ‚‚ âŸ©
      Î¼âŠ†Î¼â‚ = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
      Î¼â‚âŠ†Î¼â‚‚ = step-â‰ˆá´´ {{ isVá´¾â€² }} {{ isVá´± }} xâ‚ pcâ‹¤A
  in trans-â‰ˆá´¾-Î¹ Î¼âŠ†Î¼â‚ Î¼â‚âŠ†Î¼â‚‚

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Testâ‚‚ x xâ‚ â„“âŠ‘ refl) pcâ‹¤A =
  let isVá´± âˆ§ isVá´¾â€² âˆ§ isVâ‚‚â€² = valid-invariant x âŸ¨ isVá´¾ , isVâ‚‚ âŸ©
      Î¼âŠ†Î¼â‚ = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
      Î¼â‚âŠ†Î¼â‚‚ = step-â‰ˆá´´ {{ isVá´¾â€² }} {{ isVá´± }} xâ‚ pcâ‹¤A
  in trans-â‰ˆá´¾-Î¹ Î¼âŠ†Î¼â‚ Î¼â‚âŠ†Î¼â‚‚

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} Fun pcâ‹¤A = refl-â‰ˆá´¾ {{isVá´¾}}
step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (App {Î¸' = Î¸'} x xâ‚ refl xâ‚ƒ) pcâ‹¤A =
  let isVá´± âˆ§ isVá´¾â€² âˆ§ isVâ‚‚â€² = valid-invariant x âŸ¨ isVá´¾ , isVâ‚‚ âŸ©
      isVá´±â€² âˆ§ isVá´¾â€²â€² âˆ§ isVâ‚‚â€²â€² = valid-invariant xâ‚ âŸ¨ isVá´¾â€² , isVá´± âŸ©
      Î¼âŠ†Î¼â‚ = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
      Î¼â‚âŠ†Î¼â‚‚ = step-â‰ˆá´´ {{ isVá´¾â€² }} {{ isVá´± }} xâ‚ pcâ‹¤A
      isVá´±â€²â€² = {!!} -- validá´±-âŠ†á¶œ {Î¸ = Î¸'} (step-âŠ†á´´ xâ‚) isVâ‚‚â€²
      Î¼â‚‚âŠ†Î¼â‚ƒ = step-â‰ˆá´´ {{ isVá´¾â€²â€² }} {{ isVâ‚‚â€²â€² âˆ§ isVá´±â€²â€² }} xâ‚ƒ (trans-â‹¤ (join-âŠ‘â‚ _ _) pcâ‹¤A)
  in trans-â‰ˆá´¾-Î¹ Î¼âŠ†Î¼â‚ (trans-â‰ˆá´¾-Î¹ Î¼â‚âŠ†Î¼â‚‚ Î¼â‚‚âŠ†Î¼â‚ƒ)

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Wken p x) pcâ‹¤A = step-â‰ˆá´´ {{ isVá´¾ }} {{ validá´±-âŠ†á¶œ p isVâ‚‚ }} x pcâ‹¤A

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Inl x) pcâ‹¤A = step-â‰ˆá´´ {{ isVá´¾ }} {{ isVâ‚‚ }} x pcâ‹¤A

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Inr x) pcâ‹¤A = step-â‰ˆá´´ {{ isVá´¾ }} {{ isVâ‚‚ }} x pcâ‹¤A

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Caseâ‚ x refl xâ‚) pcâ‹¤A =
  let isVá´± âˆ§ isVá´¾â€² âˆ§ isVâ‚‚â€² = valid-invariant x âŸ¨ isVá´¾ , isVâ‚‚ âŸ©
      Î¼âŠ†Î¼â‚ = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
      Î¼â‚âŠ†Î¼â‚‚ = step-â‰ˆá´´ {{ isVá´¾â€² }} {{ isVâ‚‚â€² âˆ§ isVá´± }} xâ‚ (trans-â‹¤ (join-âŠ‘â‚ _ _) pcâ‹¤A)
  in trans-â‰ˆá´¾-Î¹ Î¼âŠ†Î¼â‚ Î¼â‚âŠ†Î¼â‚‚

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Caseâ‚‚ x refl xâ‚) pcâ‹¤A =
  let isVá´± âˆ§ isVá´¾â€² âˆ§ isVâ‚‚â€² = valid-invariant x âŸ¨ isVá´¾ , isVâ‚‚ âŸ©
      Î¼âŠ†Î¼â‚ = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
      Î¼â‚âŠ†Î¼â‚‚ = step-â‰ˆá´´ {{ isVá´¾â€² }} {{ isVâ‚‚â€² âˆ§ isVá´± }} xâ‚ (trans-â‹¤ (join-âŠ‘â‚ _ _) pcâ‹¤A)
  in trans-â‰ˆá´¾-Î¹ Î¼âŠ†Î¼â‚ Î¼â‚âŠ†Î¼â‚‚

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Pair x xâ‚) pcâ‹¤A =
  let isVá´± âˆ§ isVá´¾â€² âˆ§ isVâ‚‚â€² = valid-invariant x âŸ¨ isVá´¾ , isVâ‚‚ âŸ©
      Î¼âŠ†Î¼â‚ = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
      Î¼â‚âŠ†Î¼â‚‚ = step-â‰ˆá´´ {{ isVá´¾â€² }} {{ isVá´± }} xâ‚ pcâ‹¤A
  in trans-â‰ˆá´¾-Î¹ Î¼âŠ†Î¼â‚ Î¼â‚âŠ†Î¼â‚‚

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Fst x refl) pcâ‹¤A = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Snd x xâ‚) pcâ‹¤A = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (LabelOf x) pcâ‹¤A = step-â‰ˆá´´ {{ isVá´¾ }} {{ isVâ‚‚ }} x pcâ‹¤A
step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} GetLabel pcâ‹¤A = refl-â‰ˆá´¾ {{isVá´¾}}
step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Taint refl x xâ‚ pc'âŠ‘pc'') pcâ‹¤A =
  let isVá´± âˆ§ isVá´¾â€² âˆ§ isVâ‚‚â€² = valid-invariant x âŸ¨ isVá´¾ , isVâ‚‚ âŸ©
      Î¼âŠ†Î¼â‚ = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
      Î¼â‚âŠ†Î¼â‚‚ = step-â‰ˆá´´ {{ isVá´¾â€² }} {{ isVá´± }} xâ‚ (trans-â‹¤ (join-âŠ‘â‚ _ _) pcâ‹¤A)
  in trans-â‰ˆá´¾-Î¹ Î¼âŠ†Î¼â‚ Î¼â‚âŠ†Î¼â‚‚

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (LabelOfRef x eq) pcâ‹¤A = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (New x) pcâ‹¤A =
  -- TODO: should be like the previous formalization
  let âŸ¨ â‰ˆË¢ , â‰ˆá´´ âŸ© = step-â‰ˆá´´ {{ isVá´¾ }} {{isVâ‚‚}} x pcâ‹¤A
      _ âˆ§ âŸ¨ isVË¢â€² , isVá´´â€² âŸ© âˆ§ _ = valid-invariant x âŸ¨ isVá´¾ , isVâ‚‚ âŸ©
      â‰ˆË¢â€² = {!updateá´´-â‰ˆË¢ ? ? {{ ? }} ?!} in -- updateá´´-â‰ˆË¢ ? ? {{ ? }} ? ? ?
      âŸ¨ â‰ˆË¢â€² , â‰ˆá´´ âŸ© -- snoc-â‰ˆá´´ _ (step-â‰ˆá´´ {{ isVá´¾ }} {{ isVâ‚‚ }} x pcâ‹¤A)
-- âŸ¨ {!!} , {!refl-â‰ˆá´´!} âŸ© -- snoc-â‰ˆá´´ _ (step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} x pcâ‹¤A)

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Read x xâ‚ eq) pcâ‹¤A = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Write {â„“ = â„“} {n = n} {Ï„ = Ï„} x âŠ‘â‚ xâ‚ âŠ‘â‚‚ w) pcâ‹¤A = {!!}
  -- Outdated: This case should be the same as in the old formalizatiom
  -- let isVá´± âˆ§ isVá´¾â€² âˆ§ isVâ‚‚â€² = valid-invariant x âŸ¨ isVá´¾ , isVâ‚‚ âŸ©
  --     isVá´±â€² âˆ§ isVá´¾â€²â€² âˆ§ isVâ‚‚â€²â€² = valid-invariant xâ‚ âŸ¨ isVá´¾â€² , isVá´± âŸ©
  --     -- ref âˆ§ âˆˆâ‚‚ = validá´¿-âŠ†á´´ {r = Refá´µ {Ï„ = Ï„} â„“ n} (step-âŠ†á´´ xâ‚) isVâ‚‚â€²
  --     Î¼âŠ†Î¼â‚ = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
  --     Î¼â‚âŠ†Î¼â‚‚ = step-â‰ˆá´´ {{ isVá´¾â€² }} {{ isVá´± }} xâ‚ pcâ‹¤A
  --     â„“â‹¤A = trans-â‹¤ (trans-âŠ‘ (step-âŠ‘ x) âŠ‘â‚) pcâ‹¤A
  --     câ‰ˆc' = {!!} -- S.âŒ S.cellá´´ â„“â‹¤A  â„“â‹¤A âŒŸ
  --     Î¼â‚‚â‰ˆÎ¼â‚ƒ = âŸ¨ {!!} , writeá´´-â‰ˆá´´ {{ {!!}â€„ }} {!!} {!w!} {!!} âŸ© -- writeá´´-â‰ˆá´´ {{ isVá´¾â€²â€²â€„ }} âˆˆâ‚‚ w câ‰ˆc' -- Do I need the valid assumption here?
  -- in trans-â‰ˆá´¾-Î¹ Î¼âŠ†Î¼â‚ (trans-â‰ˆá´¾-Î¹ Î¼â‚âŠ†Î¼â‚‚ Î¼â‚‚â‰ˆÎ¼â‚ƒ)

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (LabelOfRef-FS x xâ‚ eq) pcâ‹¤A = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
step-â‰ˆá´´ {{âŸ¨ isVË¢ , isVá´´ âŸ©}} {{isVâ‚‚}} (New-FS x) pcâ‹¤A =
  let âŸ¨ â‰ˆË¢ , â‰ˆá´´ âŸ© = step-â‰ˆá´´ {{ âŸ¨ isVË¢ , isVá´´ âŸ© }} {{isVâ‚‚}} x pcâ‹¤A
      _ âˆ§ âŸ¨ isVË¢â€² , isVá´´â€² âŸ© âˆ§ _ = valid-invariant x âŸ¨ âŸ¨ isVË¢ , isVá´´ âŸ© , isVâ‚‚ âŸ©
      â‰ˆË¢â€² =  trans-â‰ˆË¢-Î¹ â‰ˆË¢ refl-â‰ˆË¢ (refl-â‰ˆË¢ {{ validË¢-âŠ†á´´ (step-âŠ†á´´ x) {!isVË¢â€²!} }}) in -- trans-â‰ˆË¢-Î¹ â‰ˆË¢ refl-â‰ˆË¢ refl-â‰ˆË¢ in
      âŸ¨ â‰ˆË¢â€² , snoc-â‰ˆá´´ _ â‰ˆá´´ âŸ© -- snoc-â‰ˆá´´ _ (step-â‰ˆá´´ {{ isVá´¾ }} {{ isVâ‚‚ }} x pcâ‹¤A)
step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Read-FS x xâ‚ eq) pcâ‹¤A = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Write-FS {â„“ = â„“} {â„“â‚} {â„“â‚‚} {â„“â‚‚'} x xâ‚ âˆˆâ‚ âŠ‘â‚ refl w) pcâ‹¤A =
  let isVá´± âˆ§ isVá´¾â€² âˆ§ isVâ‚‚â€² = valid-invariant x âŸ¨ isVá´¾ , isVâ‚‚ âŸ©
      isVá´±â€² âˆ§ isVá´¾â€²â€² âˆ§ isVâ‚‚â€²â€² = valid-invariant xâ‚ âŸ¨ isVá´¾â€² , isVá´± âŸ©
      Î¼âŠ†Î¼â‚ = step-â‰ˆá´´ {{ isVá´¾ }} x pcâ‹¤A
      Î¼â‚âŠ†Î¼â‚‚ = step-â‰ˆá´´ {{ isVá´¾â€² }} {{ isVá´± }} xâ‚ pcâ‹¤A
      vâ‰ˆ = Valueá´´ (trans-â‹¤ (trans-âŠ‘ (step-âŠ‘ x) âŠ‘â‚) pcâ‹¤A) (join-â‹¤â‚ (trans-â‹¤ (step-âŠ‘ x) pcâ‹¤A))
      Î¼â‚‚â‰ˆÎ¼â‚ƒ = writeá´´-â‰ˆá´´ {{ {!!} }} âˆˆâ‚ w vâ‰ˆ
  in trans-â‰ˆá´¾-Î¹ Î¼âŠ†Î¼â‚ (trans-â‰ˆá´¾-Î¹ Î¼â‚âŠ†Î¼â‚‚ âŸ¨ refl-â‰ˆË¢ {{ {!!} }} , Î¼â‚‚â‰ˆÎ¼â‚ƒ âŸ© )

step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (Id x) pcâ‹¤A = step-â‰ˆá´´ {{ isVá´¾ }} {{ isVâ‚‚ }} x pcâ‹¤A
step-â‰ˆá´´ {{isVá´¾}} {{isVâ‚‚}} (UnId x eq) pcâ‹¤A = step-â‰ˆá´´ {{ isVá´¾ }} {{ isVâ‚‚ }} x pcâ‹¤A

--------------------------------------------------------------------------------

open _â‰ˆâŸ¨_,_âŸ©á´¬_
open import Data.Unit hiding (_â‰Ÿ_) -- ?
-- open import Generic.Heap ğ‘¯
-- open SecurityLattice ğ‘³
-- open import Generic.LValue
-- open HasLabel ğ‘¯ -- import Generic.LValue as H

wken-âˆƒ : âˆ€ {Ï„ Î² Î²'} {câ‚ câ‚‚ : FConf Ï„} â†’
         Î² âŠ† Î²' â†’ (x : âˆƒ (Î» Î²'' â†’ Î²' âŠ† Î²'' Ã— câ‚ â‰ˆâŸ¨ Î²'' âŸ©á¶œ câ‚‚)) â†’
         âˆƒ (Î» Î²'' â†’ Î² âŠ† Î²'' Ã— câ‚ â‰ˆâŸ¨ Î²'' âŸ©á¶œ câ‚‚)
wken-âˆƒ Î²âŠ†Î²' (Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ â‰ˆâ‚)  = Î²'' âˆ§ (trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'') âˆ§ â‰ˆâ‚

mutual

  -- TINI for low steps
  postulate tiniá´¸ : âˆ€ {pc Î² Ï„ Î“ Î¼â‚ Î¼â‚‚ Î£â‚ Î£â‚‚ e} {Î¸â‚ Î¸â‚‚ : Env Î“} {câ‚' câ‚‚' : FConf Ï„} â†’
                    let câ‚ = âŸ¨ Î£â‚ , Î¼â‚ ,  e âŸ©
                        câ‚‚ = âŸ¨ Î£â‚‚ , Î¼â‚‚ ,  e âŸ© in
                    câ‚ â‡“âŸ¨ Î¸â‚ , pc âŸ© câ‚' â†’
                    câ‚‚ â‡“âŸ¨ Î¸â‚‚ , pc âŸ© câ‚‚' â†’
                    âŸ¨ Î£â‚ , Î¼â‚ âŸ© â‰ˆâŸ¨ Î² âŸ©á´¾ âŸ¨ Î£â‚‚ , Î¼â‚‚ âŸ© â†’
                    Î¸â‚ â‰ˆâŸ¨ Î² âŸ©á´± Î¸â‚‚ â†’
                    pc âŠ‘ A â†’
                    âˆƒ (Î» Î²' â†’ Î² âŠ† Î²' Ã— câ‚' â‰ˆâŸ¨ Î²' âŸ©á¶œ câ‚‚')
  -- tiniá´¸ (Var Ï„âˆˆÎ“ refl) (Var .Ï„âˆˆÎ“ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A = _ âˆ§ refl-âŠ† âˆ§ âŸ¨ ? , Î¼â‚â‰ˆÎ¼â‚‚ , â‰ˆâ±½-âŠ‘ _ vâ‚â‰ˆvâ‚‚ âŸ©
  --   where vâ‚â‰ˆvâ‚‚ = lookup-â‰ˆâ±½ Ï„âˆˆÎ“ Î¸â‚â‰ˆÎ¸â‚‚

  -- tiniá´¸ Unit Unit Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A = _ âˆ§ refl-âŠ† âˆ§ âŸ¨ Î¼â‚â‰ˆÎ¼â‚‚ , Valueá´¸ pcâŠ‘A Unit âŸ©

  -- tiniá´¸ (Lbl â„“) (Lbl .â„“) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A = _ âˆ§ refl-âŠ† âˆ§ âŸ¨ Î¼â‚â‰ˆÎ¼â‚‚ , Valueá´¸ pcâŠ‘A (Lbl â„“) âŸ©

  -- -- Both true
  -- tiniá´¸ (Testâ‚ xâ‚ xâ‚‚ â„“â‚âŠ‘â„“â‚‚ refl) (Testâ‚ yâ‚ yâ‚‚ _ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ yâ‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨  Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ _ (Lbl â„“â‚) âŸ© with tiniá´¸ xâ‚‚ yâ‚‚ Î¼â‚'â‰ˆÎ¼â‚‚' (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A

  -- tiniá´¸ (Testâ‚ xâ‚ xâ‚‚ â„“â‚âŠ‘â„“â‚‚ refl) (Testâ‚ yâ‚ yâ‚‚ _ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ pâ‚ (Lbl â„“â‚) âŸ© | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´¸ pâ‚‚ (Lbl â„“â‚‚) âŸ©
  --     = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´¸ (join-âŠ‘' pâ‚ pâ‚‚) (Trueá´¸ pcâŠ‘A) âŸ©

  -- tiniá´¸ (Testâ‚ xâ‚ xâ‚‚ â„“â‚âŠ‘â„“â‚‚ refl) (Testâ‚ yâ‚ yâ‚‚ _ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ p (Lbl â„“â‚) âŸ© | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´´ Â¬pâ‚ Â¬pâ‚‚ âŸ©
  --     = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´´ (trans-â‹¤ (join-âŠ‘â‚‚ _ _) Â¬pâ‚) (trans-â‹¤ (join-âŠ‘â‚‚ _ _) Â¬pâ‚‚) âŸ©

  -- tiniá´¸ (Testâ‚ xâ‚ xâ‚‚ â„“â‚âŠ‘â„“â‚‚ refl) (Testâ‚ yâ‚ yâ‚‚ _ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´´ pcâ‹¤â„“â‚' pcâ‹¤â„“â‚‚' âŸ© with tiniá´¸ xâ‚‚ yâ‚‚ Î¼â‚'â‰ˆÎ¼â‚‚' (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A
  -- ... |  Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , vâ‰ˆ âŸ©
  --   = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´´ (trans-â‹¤ (join-âŠ‘â‚ _ _) pcâ‹¤â„“â‚' ) (trans-â‹¤ (join-âŠ‘â‚ _ _) pcâ‹¤â„“â‚‚' ) âŸ©

  --   -- True vs False
  -- tiniá´¸ (Testâ‚ xâ‚ xâ‚‚ â„“â‚âŠ‘â„“â‚‚ refl) (Testâ‚‚ yâ‚ yâ‚‚ â„“â‚â‹¤â„“â‚‚ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ yâ‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | _ âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ _ (Lbl â„“â‚) âŸ© with tiniá´¸ xâ‚‚ yâ‚‚ Î¼â‚'â‰ˆÎ¼â‚‚' (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A

  -- tiniá´¸ (Testâ‚ xâ‚ xâ‚‚ â„“â‚âŠ‘â„“â‚‚ refl) (Testâ‚‚ yâ‚ yâ‚‚ â„“â‚â‹¤â„“â‚‚ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | _ âˆ§ _ âˆ§  âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ pâ‚ (Lbl â„“â‚) âŸ© | _ âˆ§ _ âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´¸ pâ‚‚ (Lbl â„“â‚‚) âŸ©
  --     = âŠ¥-elim (â„“â‚â‹¤â„“â‚‚ â„“â‚âŠ‘â„“â‚‚)

  -- tiniá´¸ (Testâ‚ xâ‚ xâ‚‚ â„“â‚âŠ‘â„“â‚‚ refl) (Testâ‚‚ yâ‚ yâ‚‚ _ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ p (Lbl â„“â‚) âŸ© | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´´ Â¬pâ‚ Â¬pâ‚‚ âŸ©
  --     = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´´ (trans-â‹¤ (join-âŠ‘â‚‚ _ _) Â¬pâ‚) (trans-â‹¤ (join-âŠ‘â‚‚ _ _) Â¬pâ‚‚) âŸ©

  -- tiniá´¸ (Testâ‚ xâ‚ xâ‚‚ â„“â‚âŠ‘â„“â‚‚ refl) (Testâ‚‚ yâ‚ yâ‚‚ _ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´´ pcâ‹¤â„“â‚' pcâ‹¤â„“â‚‚' âŸ© with tiniá´¸ xâ‚‚ yâ‚‚ Î¼â‚'â‰ˆÎ¼â‚‚' (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A
  -- ... | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , vâ‰ˆ âŸ© = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´´ (trans-â‹¤ (join-âŠ‘â‚ _ _) pcâ‹¤â„“â‚' ) (trans-â‹¤ (join-âŠ‘â‚ _ _) pcâ‹¤â„“â‚‚' ) âŸ©

  -- -- False vs True
  -- tiniá´¸ (Testâ‚‚ xâ‚ xâ‚‚ â„“â‚â‹¤â„“â‚‚ refl) (Testâ‚ yâ‚ yâ‚‚ â„“â‚âŠ‘â„“â‚‚ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ yâ‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | _ âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ _ (Lbl â„“â‚) âŸ© with tiniá´¸ xâ‚‚ yâ‚‚ Î¼â‚'â‰ˆÎ¼â‚‚' (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A

  -- tiniá´¸ (Testâ‚‚ xâ‚ xâ‚‚ â„“â‚â‹¤â„“â‚‚ refl) (Testâ‚ yâ‚ yâ‚‚ â„“â‚âŠ‘â„“â‚‚ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | _ âˆ§ _ âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ pâ‚ (Lbl â„“â‚) âŸ© | _ âˆ§ _ âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´¸ pâ‚‚ (Lbl â„“â‚‚) âŸ©
  --     = âŠ¥-elim (â„“â‚â‹¤â„“â‚‚ â„“â‚âŠ‘â„“â‚‚)

  -- tiniá´¸ (Testâ‚‚ xâ‚ xâ‚‚ â„“â‚â‹¤â„“â‚‚ refl) (Testâ‚ yâ‚ yâ‚‚ _ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ p (Lbl â„“â‚) âŸ© | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´´ Â¬pâ‚ Â¬pâ‚‚ âŸ©
  --   = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´´ (trans-â‹¤ (join-âŠ‘â‚‚ _ _) Â¬pâ‚) (trans-â‹¤ (join-âŠ‘â‚‚ _ _) Â¬pâ‚‚) âŸ©

  -- tiniá´¸ (Testâ‚‚ xâ‚ xâ‚‚ â„“â‚â‹¤â„“â‚‚ refl) (Testâ‚ yâ‚ yâ‚‚ â„“â‚âŠ‘â„“â‚‚ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´´ pcâ‹¤â„“â‚' pcâ‹¤â„“â‚‚' âŸ© with tiniá´¸ xâ‚‚ yâ‚‚ Î¼â‚'â‰ˆÎ¼â‚‚' (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A
  -- ... | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , vâ‰ˆ âŸ© = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´´ (trans-â‹¤ (join-âŠ‘â‚ _ _) pcâ‹¤â„“â‚' ) (trans-â‹¤ (join-âŠ‘â‚ _ _) pcâ‹¤â„“â‚‚' ) âŸ©


  -- -- False and False
  -- tiniá´¸ (Testâ‚‚ xâ‚ xâ‚‚ â„“â‚â‹¤â„“â‚‚ refl) (Testâ‚‚ yâ‚ yâ‚‚ _ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ yâ‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ _ (Lbl â„“â‚) âŸ© with tiniá´¸ xâ‚‚ yâ‚‚ Î¼â‚'â‰ˆÎ¼â‚‚' (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A

  -- tiniá´¸ (Testâ‚‚ xâ‚ xâ‚‚ â„“â‚â‹¤â„“â‚‚ refl) (Testâ‚‚ yâ‚ yâ‚‚ _ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ pâ‚ (Lbl â„“â‚) âŸ© | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´¸ pâ‚‚ (Lbl â„“â‚‚) âŸ©
  --     = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´¸ (join-âŠ‘' pâ‚ pâ‚‚) (Falseá´¸ pcâŠ‘A) âŸ©

  -- tiniá´¸ (Testâ‚‚ xâ‚ xâ‚‚ â„“â‚â‹¤â„“â‚‚ refl) (Testâ‚‚ yâ‚ yâ‚‚ _ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ p (Lbl â„“â‚) âŸ© | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´´ Â¬pâ‚ Â¬pâ‚‚ âŸ©
  --     = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´´ (trans-â‹¤ (join-âŠ‘â‚‚ _ _) Â¬pâ‚) (trans-â‹¤ (join-âŠ‘â‚‚ _ _) Â¬pâ‚‚) âŸ©

  -- tiniá´¸ (Testâ‚‚ xâ‚ xâ‚‚ â„“â‚â‹¤â„“â‚‚ refl) (Testâ‚‚ yâ‚ yâ‚‚ _ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´´ pcâ‹¤â„“â‚' pcâ‹¤â„“â‚‚' âŸ© with tiniá´¸ xâ‚‚ yâ‚‚ Î¼â‚'â‰ˆÎ¼â‚‚' (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A
  -- ... | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , vâ‰ˆ âŸ©
  --   = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚ƒâ‰ˆÎ¼â‚ƒ' , Valueá´´ (trans-â‹¤ (join-âŠ‘â‚ _ _) pcâ‹¤â„“â‚' ) (trans-â‹¤ (join-âŠ‘â‚ _ _) pcâ‹¤â„“â‚‚' ) âŸ©

  -- tiniá´¸ Fun Fun Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A = _ âˆ§ refl-âŠ† âˆ§ âŸ¨ Î¼â‚â‰ˆÎ¼â‚‚ , Valueá´¸ pcâŠ‘A (Fun Î¸â‚â‰ˆÎ¸â‚‚) âŸ©

  -- tiniá´¸ (App x xâ‚ eqâ‚ xâ‚ƒ) (App xâ‚„ xâ‚… eqâ‚‚ xâ‚‡) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ x xâ‚„ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , vâ‚â‰ˆvâ‚‚ âŸ© with tiniá´¸ xâ‚ xâ‚… Î¼â‚'â‰ˆÎ¼â‚‚' (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A
  -- tiniá´¸ (App x xâ‚ eqâ‚ xâ‚ƒ) (App xâ‚„ xâ‚… eqâ‚‚ xâ‚‡) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , E.Valueá´¸ pcâŠ‘â„“' (Fun Î¸â‚'â‰ˆÎ¸â‚‚') âŸ© | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚''â‰ˆÎ¼â‚‚'' , vâ‚'â‰ˆvâ‚‚' âŸ©
  --     rewrite eqâ‚ | eqâ‚‚ = wken-âˆƒ (trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'') (tini {{ {!!} }} {{ {!!} }} xâ‚ƒ xâ‚‡  âŸ¨ Î¼â‚''â‰ˆÎ¼â‚‚'' , refl âŸ© (vâ‚'â‰ˆvâ‚‚' âˆ· wken-â‰ˆá´± Î²'âŠ†Î²'' Î¸â‚'â‰ˆÎ¸â‚‚' ))

  -- tiniá´¸ (App x xâ‚ eqâ‚ xâ‚ƒ) (App xâ‚„ xâ‚… eqâ‚‚ xâ‚‡) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , E.Valueá´´ pcâ‹¤â„“â‚ pcâ‹¤â„“â‚‚ âŸ© | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚''â‰ˆÎ¼â‚‚'' , vâ‚'â‰ˆvâ‚‚' âŸ©
  --     rewrite eqâ‚ | eqâ‚‚ =  wken-âˆƒ (trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'') (tiniá´´ {{ {!!} }} {{ {!!} }} Î¼â‚''â‰ˆÎ¼â‚‚'' xâ‚ƒ xâ‚‡ (trans-â‹¤ (join-âŠ‘â‚‚ _ _) pcâ‹¤â„“â‚) (trans-â‹¤ (join-âŠ‘â‚‚ _ _) pcâ‹¤â„“â‚‚))

  -- tiniá´¸ (Wken p x) (Wken .p xâ‚) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A = tiniá´¸ x xâ‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚â€² pcâŠ‘A
  --   where Î¸â‚â‰ˆÎ¸â‚‚â€² = slice-â‰ˆá´± Î¸â‚â‰ˆÎ¸â‚‚ p

  -- tiniá´¸ (Inl x) (Inl xâ‚) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ x xâ‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , vâ‚â‰ˆvâ‚‚ âŸ© =  Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ pcâŠ‘A (Inl vâ‚â‰ˆvâ‚‚) âŸ©

  -- tiniá´¸ (Inr x) (Inr xâ‚) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ x xâ‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , vâ‚â‰ˆvâ‚‚ âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ pcâŠ‘A (Inr vâ‚â‰ˆvâ‚‚) âŸ©

  -- tiniá´¸ (Caseâ‚ x refl xâ‚‚) (Caseâ‚ xâ‚ƒ refl xâ‚…) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ x xâ‚ƒ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ â„“âŠ‘A (Inl vâ‚â‰ˆvâ‚‚) âŸ© = wken-âˆƒ Î²âŠ†Î²' (tini {{ {!!} }} {{ {!!} }} xâ‚‚ xâ‚… âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , refl âŸ© (vâ‚â‰ˆvâ‚‚ âˆ· wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚))
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , (Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A) âŸ© = wken-âˆƒ Î²âŠ†Î²' (tiniá´´ {{ {!!} }} {{ {!!} }} Î¼â‚'â‰ˆÎ¼â‚‚' xâ‚‚ xâ‚… (join-â‹¤â‚‚ â„“â‚â‹¤A) (join-â‹¤â‚‚ â„“â‚‚â‹¤A))

  -- tiniá´¸ (Caseâ‚ x refl xâ‚‚) (Caseâ‚‚ xâ‚ƒ refl xâ‚…) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ x xâ‚ƒ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ â„“âŠ‘A () âŸ©
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A âŸ© = wken-âˆƒ Î²âŠ†Î²' (tiniá´´ {{ {!!} }} {{ {!!} }} Î¼â‚'â‰ˆÎ¼â‚‚' xâ‚‚ xâ‚… (join-â‹¤â‚‚ â„“â‚â‹¤A) (join-â‹¤â‚‚ â„“â‚‚â‹¤A))

  -- tiniá´¸ (Caseâ‚‚ x refl xâ‚‚) (Caseâ‚ xâ‚ƒ refl xâ‚…) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ x xâ‚ƒ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ â„“âŠ‘A () âŸ©
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A âŸ© = wken-âˆƒ Î²âŠ†Î²' (tiniá´´ {{ {!!} }} {{ {!!} }} Î¼â‚'â‰ˆÎ¼â‚‚' xâ‚‚ xâ‚… (join-â‹¤â‚‚ â„“â‚â‹¤A) (join-â‹¤â‚‚ â„“â‚‚â‹¤A))

  -- tiniá´¸ (Caseâ‚‚ x refl xâ‚‚) (Caseâ‚‚ xâ‚ƒ refl xâ‚…) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ x xâ‚ƒ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ â„“âŠ‘A (Inr vâ‚â‰ˆvâ‚‚) âŸ© = wken-âˆƒ Î²âŠ†Î²' (tini {{ {!!} }} {{ {!!} }} xâ‚‚ xâ‚… âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , refl âŸ© (vâ‚â‰ˆvâ‚‚ âˆ· wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚))
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A âŸ© = wken-âˆƒ Î²âŠ†Î²' (tiniá´´ {{ {!!} }} {{ {!!} }} Î¼â‚'â‰ˆÎ¼â‚‚' xâ‚‚ xâ‚… (join-â‹¤â‚‚ â„“â‚â‹¤A) (join-â‹¤â‚‚ â„“â‚‚â‹¤A))

  -- tiniá´¸ (Pair x xâ‚) (Pair xâ‚‚ xâ‚ƒ) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ x xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , vâ‚â‰ˆvâ‚' âŸ© with tiniá´¸ xâ‚ xâ‚ƒ Î¼â‚'â‰ˆÎ¼â‚‚' (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A
  -- ... | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚''â‰ˆÎ¼â‚‚'' , vâ‚‚â‰ˆvâ‚‚' âŸ© = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‚''â‰ˆÎ¼â‚‚'' , Valueá´¸ pcâŠ‘A (Pair (wken-â‰ˆâ±½ Î²'âŠ†Î²'' vâ‚â‰ˆvâ‚') vâ‚‚â‰ˆvâ‚‚') âŸ©

  -- tiniá´¸ (Fst x refl) (Fst xâ‚‚ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ x xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ â„“âŠ‘A (Pair vâ‚â‰ˆvâ‚' vâ‚‚â‰ˆvâ‚‚') âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , â‰ˆâ±½-âŠ‘ _ vâ‚â‰ˆvâ‚' âŸ©
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´´ (join-â‹¤â‚ â„“â‚â‹¤A) (join-â‹¤â‚ â„“â‚‚â‹¤A) âŸ©

  -- tiniá´¸ (Snd x refl) (Snd xâ‚‚ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ x xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ â„“âŠ‘A (Pair vâ‚â‰ˆvâ‚' vâ‚‚â‰ˆvâ‚‚') âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , â‰ˆâ±½-âŠ‘ _ vâ‚‚â‰ˆvâ‚‚' âŸ©
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , (Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A) âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´´ (join-â‹¤â‚ â„“â‚â‹¤A) (join-â‹¤â‚ â„“â‚‚â‹¤A) âŸ©

  -- tiniá´¸ (LabelOf x) (LabelOf xâ‚) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ x xâ‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ â„“âŠ‘A vâ‚â‰ˆvâ‚‚ âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´¸ â„“âŠ‘A (Lbl _) âŸ©
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A âŸ©

  -- tiniá´¸ GetLabel GetLabel Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A = _ âˆ§ refl-âŠ† âˆ§ âŸ¨ Î¼â‚â‰ˆÎ¼â‚‚ , Valueá´¸ pcâŠ‘A (Lbl _) âŸ©

  -- tiniá´¸ (Taint refl xâ‚ xâ‚‚ pc'âŠ‘pc'') (Taint refl xâ‚ƒ xâ‚„ pc'âŠ‘pc''') Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ xâ‚ƒ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , E.Valueá´¸ â„“âŠ‘A (E.Lbl â„“) âŸ© = wken-âˆƒ Î²âŠ†Î²' ( tini {{ {!!} }} {{ {!!} }} xâ‚‚ xâ‚„ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , refl âŸ© (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚))
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , (Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A) âŸ© =  wken-âˆƒ Î²âŠ†Î²' (tiniá´´ {{ {!!} }} {{ {!!} }} Î¼â‚'â‰ˆÎ¼â‚‚' xâ‚‚ xâ‚„ (trans-â‹¤ pc'âŠ‘pc'' â„“â‚â‹¤A) (trans-â‹¤ pc'âŠ‘pc''' â„“â‚‚â‹¤A))

  -- tiniá´¸ (LabelOfRef xâ‚ refl) (LabelOfRef xâ‚‚ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´¸ â„“âŠ‘A (Ref-Iá´¸ â„“âŠ‘Aâ‚ n) âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , (Valueá´¸ (join-âŠ‘' â„“âŠ‘Aâ‚ â„“âŠ‘A) (Lbl _)) âŸ©
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´¸ â„“âŠ‘A (Ref-Iá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A) âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , (Valueá´´ (trans-â‹¤ (join-âŠ‘â‚ _ _) â„“â‚â‹¤A) (trans-â‹¤ (join-âŠ‘â‚ _ _) â„“â‚‚â‹¤A)) âŸ©
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´´ (trans-â‹¤ (join-âŠ‘â‚‚ _ _) â„“â‚â‹¤A) (trans-â‹¤ (join-âŠ‘â‚‚ _ _) â„“â‚‚â‹¤A) âŸ©

  -- tiniá´¸  {pc = pc} {Î¼â‚ = Î¼â‚} {Î¼â‚‚ = Î¼â‚‚} (New {â„“ = â„“â‚} {Ï„ = Ï„} {Î¼' = Î¼â‚'} {r = râ‚} xâ‚) (New {â„“ = â„“â‚‚} {Î¼' = Î¼â‚‚'} {r = râ‚‚} xâ‚‚) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , vâ‰ˆ  âŸ© = Î²'' âˆ§ Î²âŠ†Î²'' âˆ§ âŸ¨ Î¼â‰ˆâ€² , vâ‰ˆâ€² âŸ©
  --     where instance _ = _â‰Ÿ_
  --                    _ = â‰ˆ-# Î¼â‰ˆ
  --           Î²â‚ =  âˆ¥ Î¼â‚' âˆ¥á´´ â†” âˆ¥ Î¼â‚‚' âˆ¥á´´
  --           Î²'' = Î²' âˆ£á´® Î²â‚
  --           Î²'âŠ†Î²'' = âˆ£á´®-âŠ†â‚ Î²' Î²â‚
  --           Î²âŠ†Î²'' = trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²''
  --           Î¼â‰ˆâ€² = newá´¸-â‰ˆá´´ ? ? -- (â‰ˆâ±½-â‰ˆá¶œ vâ‰ˆ) Î¼â‰ˆ
  --           vâ‰ˆâ€² = Valueá´¸ pcâŠ‘A (Ref-Iâ€² (bij-âŠ† (âˆ£á´®-âŠ†â‚‚ Î²' Î²â‚) ? ?)) -- (â†”-âˆˆáµ— âˆ¥ Î¼â‚' âˆ¥ âˆ¥ Î¼â‚‚' âˆ¥)) (wken-â‰ˆâ±½ Î²'âŠ†Î²'' vâ‰ˆ))

  -- tiniá´¸ (Read xâ‚ nâˆˆMâ‚ refl) (Read xâ‚‚ nâˆˆMâ‚‚ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨  Î¼â‰ˆ , Valueá´¸ â„“âŠ‘A (Ref-Iá´¸ â„“'âŠ‘A x) âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , â‰ˆâ±½-âŠ‘ _ vâ‰ˆ âŸ©
  --      where vâ‰ˆ = ? -- â‰ˆá¶œ-â‰ˆâ±½ (readá´¸-â‰ˆá¶œ x nâˆˆMâ‚ nâˆˆMâ‚‚ Î¼â‰ˆ)

  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´¸ â„“âŠ‘A (Ref-Iá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A) âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , vâ‰ˆ âŸ©
  --   where vâ‰ˆ = Valueá´´ (trans-â‹¤ (join-âŠ‘â‚‚ _ _) â„“â‚â‹¤A) (trans-â‹¤ (join-âŠ‘â‚‚ _ _) â„“â‚‚â‹¤A)

  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , vâ‰ˆ âŸ©
  --   where vâ‰ˆ = Valueá´´ (trans-â‹¤ (join-âŠ‘â‚ _ _) â„“â‚â‹¤A) (trans-â‹¤ (join-âŠ‘â‚ _ _) â„“â‚‚â‹¤A)

  -- tiniá´¸ (Write {â„“ = â„“â‚} xâ‚ âŠ‘â‚ yâ‚ â„“â‚‚âŠ‘â„“ wâ‚) (Write {â„“ = â„“â‚‚} xâ‚‚ âŠ‘â‚‚ yâ‚‚ â„“â‚‚âŠ‘â„“' wâ‚‚) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A

  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A âŸ© with tiniá´¸ yâ‚ yâ‚‚ Î¼â‰ˆ (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A
  -- ... | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‰ˆâ€² , vâ‰ˆ âŸ© = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‰ˆâ€²â€² , Valueá´¸ pcâŠ‘A Unit âŸ©
  --   where
  --         postulate valid-refâ‚ : Validá´¿ _ (Refá´µ â„“â‚ _)
  --         postulate valid-refâ‚‚ : Validá´¿ _ (Refá´µ â„“â‚‚ _)
  --         câ‰ˆâ‚ = ? -- âŒ cellá´´ (trans-â‹¤ âŠ‘â‚ â„“â‚â‹¤A ) (trans-â‹¤ âŠ‘â‚ â„“â‚â‹¤A) âŒŸ
  --         câ‰ˆâ‚‚ = ? -- âŒ cellá´´ (trans-â‹¤ âŠ‘â‚‚ â„“â‚‚â‹¤A ) (trans-â‹¤ âŠ‘â‚‚ â„“â‚‚â‹¤A) âŒŸ
  --         Î¼â‰ˆâ€²â€² = square-â‰ˆá´´-Î¹ Î¼â‰ˆâ€² (writeá´´-â‰ˆá´´ {{ {!!} }} (projâ‚‚ valid-refâ‚) wâ‚ câ‰ˆâ‚)
  --                                (writeá´´-â‰ˆá´´ {{ {!!} }} (projâ‚‚ valid-refâ‚‚) wâ‚‚ câ‰ˆâ‚‚)

  -- tiniá´¸ (Write xâ‚ â„“'âŠ‘â„“ yâ‚ â„“â‚‚âŠ‘â„“ wâ‚) (Write xâ‚‚ â„“'âŠ‘â„“' yâ‚‚ â„“â‚‚âŠ‘â„“' wâ‚‚) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²'  âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´¸ â„“âŠ‘A (Ref-Iá´¸ âŠ‘â€² âˆˆÎ²') âŸ© with tiniá´¸ yâ‚ yâ‚‚ Î¼â‰ˆ (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A
  -- ... | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‰ˆâ€² , vâ‰ˆ âŸ© = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‰ˆâ€²â€² , Valueá´¸ pcâŠ‘A Unit âŸ©
  --   where âˆˆÎ²'' = bij-âŠ† Î²'âŠ†Î²'' âˆˆÎ²'
  --         Î¼â‰ˆâ€²â€² = writeá´¸-â‰ˆá´´ Î¼â‰ˆâ€² ? ? ? -- (â‰ˆâ±½-â‰ˆá¶œ (Valueá´¸ âŠ‘â€² (extract-â‰ˆá´¿ vâ‰ˆ (trans-âŠ‘ â„“â‚‚âŠ‘â„“ âŠ‘â€²)))) wâ‚ wâ‚‚ âˆˆÎ²''

  -- tiniá´¸ (Write xâ‚ âŠ‘â‚ yâ‚ âŠ‘â‚â€² wâ‚) (Write xâ‚‚ âŠ‘â‚‚ yâ‚‚ âŠ‘â‚‚â€² wâ‚‚) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  --   | Î²' âˆ§ Î²âŠ†Î²'  âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´¸ â„“âŠ‘A (Ref-Iá´´ â‹¤â‚ â‹¤â‚‚) âŸ© with tiniá´¸ yâ‚ yâ‚‚ Î¼â‰ˆ (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A
  -- ... | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‰ˆâ€² , vâ‰ˆ âŸ© = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‰ˆâ€²â€² , Valueá´¸ pcâŠ‘A Unit âŸ©
  --     where postulate valid-refâ‚ : Validá´¿ _ (Refá´µ _ _)
  --           postulate valid-refâ‚‚ : Validá´¿ _ (Refá´µ _ _)
  --           câ‰ˆâ‚ = ? -- âŒ cellá´´ â‹¤â‚ â‹¤â‚ âŒŸ
  --           câ‰ˆâ‚‚ = ? -- âŒ cellá´´ â‹¤â‚‚ â‹¤â‚‚ âŒŸ
  --           Î¼â‰ˆâ€²â€² = square-â‰ˆá´´-Î¹ Î¼â‰ˆâ€² (writeá´´-â‰ˆá´´ {{ {!!} }} (projâ‚‚ valid-refâ‚) wâ‚ câ‰ˆâ‚) (writeá´´-â‰ˆá´´ {{ {!!} }} (projâ‚‚ valid-refâ‚‚) wâ‚‚ câ‰ˆâ‚‚)

  -- tiniá´¸ (Id xâ‚) (Id xâ‚‚) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with  tiniá´¸ xâ‚ xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , vâ‰ˆ âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´¸ pcâŠ‘A (Id vâ‰ˆ) âŸ©

  -- tiniá´¸ (UnId xâ‚ refl) (UnId xâ‚‚ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´¸ â„“âŠ‘A (Id vâ‰ˆ) âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , â‰ˆâ±½-âŠ‘ _ vâ‰ˆ âŸ©
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´´ (join-â‹¤â‚ â„“â‚â‹¤A) (join-â‹¤â‚ â„“â‚‚â‹¤A) âŸ©

  -- tiniá´¸ (LabelOfRef-FS xâ‚ âˆˆâ‚ refl) (LabelOfRef-FS xâ‚‚ âˆˆâ‚‚ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´¸ â„“âŠ‘A (Ref-S âˆˆÎ²') âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , vâ‰ˆ âŸ©
  --   where vâ‰ˆ = ? -- â‰ˆâ±½-âŠ‘ _ (label-ofâ‰ˆá¶œ-â‰ˆâ±½ (readá´¸-â‰ˆá¶œ âˆˆÎ²' âˆˆâ‚ âˆˆâ‚‚ Î¼â‰ˆ))
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´´ (join-â‹¤â‚ â„“â‚â‹¤A) (join-â‹¤â‚ â„“â‚‚â‹¤A) âŸ©

  -- tiniá´¸ (New-FS {Î¼' = Î¼â‚'} xâ‚) (New-FS {Î¼' = Î¼â‚‚'} xâ‚‚) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , vâ‰ˆ  âŸ© = Î²'' âˆ§ Î²âŠ†Î²'' âˆ§ âŸ¨ Î¼â‰ˆâ€² , wken-â‰ˆâ±½ (âˆ£á´®-âŠ†â‚‚ Î²' Î²â‚) vâ‰ˆâ€² âŸ©
  --     where instance _ = _â‰Ÿ_
  --                    _ = â‰ˆ-# Î¼â‰ˆ
  --           Î²â‚ =  âˆ¥ Î¼â‚' âˆ¥á´´ â†” âˆ¥ Î¼â‚‚' âˆ¥á´´
  --           Î²'' = Î²' âˆ£á´® Î²â‚
  --           Î²'âŠ†Î²'' = âˆ£á´®-âŠ†â‚ Î²' Î²â‚
  --           Î²âŠ†Î²'' = trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²''
  --           Î¼â‰ˆâ€² = newá´¸-â‰ˆá´´ ? Î¼â‰ˆ --  (â‰ˆâ±½-â‰ˆá¶œ vâ‰ˆ)
  --           vâ‰ˆâ€² = Valueá´¸ pcâŠ‘A (Ref-S (â†”-âˆˆáµ— âˆ¥ Î¼â‚' âˆ¥á´´ âˆ¥ Î¼â‚‚' âˆ¥á´´)) -- (Ref-Iá´¸â€² â„“âŠ‘A (projâ‚ (â†”-âˆˆ âˆ¥ Î¼â‚' âˆ¥ âˆ¥ Î¼â‚‚' âˆ¥)))


  -- tiniá´¸ (Read-FS xâ‚ âˆˆâ‚ refl) (Read-FS xâ‚‚ âˆˆâ‚‚ refl) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , vâ‰ˆ âŸ©
  --   where vâ‰ˆ = Valueá´´ (trans-â‹¤ (join-âŠ‘â‚ _ _) â„“â‚â‹¤A ) ((trans-â‹¤ (join-âŠ‘â‚ _ _) â„“â‚‚â‹¤A ))

  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨  Î¼â‰ˆ , Valueá´¸ â„“âŠ‘A (Ref-S âˆˆÎ²) âŸ© = Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , â‰ˆâ±½-âŠ‘ _ vâ‰ˆ âŸ©
  --      where vâ‰ˆ = ? -- â‰ˆá¶œ-â‰ˆâ±½ (readá´¸-â‰ˆá¶œ âˆˆÎ² âˆˆâ‚ âˆˆâ‚‚ Î¼â‰ˆ)


  -- tiniá´¸ (Write-FS {â„“ = â„“} {â„“â‚} {â„“â‚‚} {â„“â‚‚'} xâ‚ yâ‚ âˆˆâ‚ âŠ‘â‚ refl wâ‚) (Write-FS xâ‚‚ yâ‚‚ âˆˆâ‚‚ âŠ‘â‚‚ refl wâ‚‚) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A with tiniá´¸ xâ‚ xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  -- ... | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , (Valueá´¸ â„“âŠ‘A (Ref-S âˆˆÎ²')) âŸ© with tiniá´¸ yâ‚ yâ‚‚ Î¼â‰ˆ (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A
  -- ... | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‰ˆâ€² , vâ‰ˆ âŸ© =
  --           let âˆˆÎ²'' = bij-âŠ† Î²'âŠ†Î²'' âˆˆÎ²'
  --               câ‰ˆ = ? -- readá´¸-â‰ˆá¶œ âˆˆÎ²'' âˆˆâ‚ âˆˆâ‚‚ Î¼â‰ˆâ€²
  --               Î¼â‰ˆâ€²â€² = writeá´¸-â‰ˆá´´ Î¼â‰ˆâ€² ? wâ‚ wâ‚‚ âˆˆÎ²'' in Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‰ˆâ€²â€² , Valueá´¸ pcâŠ‘A Unit âŸ© -- (â‰ˆá¶œ-âŠ‘ â„“ (taint-update-â‰ˆá¶œ câ‰ˆ vâ‰ˆ))

  -- tiniá´¸ (Write-FS {â„“ = â„“} {â„“â‚} {â„“â‚‚} {â„“â‚‚'} xâ‚ yâ‚ âˆˆâ‚ âŠ‘â‚ refl wâ‚) (Write-FS xâ‚‚ yâ‚‚ âˆˆâ‚‚ âŠ‘â‚‚ refl wâ‚‚) Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A | Î²' âˆ§ Î²âŠ†Î²' âˆ§ âŸ¨ Î¼â‰ˆ , (Valueá´´ â„“â‚â‹¤A â„“â‚‚â‹¤A) âŸ© with tiniá´¸ yâ‚ yâ‚‚ Î¼â‰ˆ (wken-â‰ˆá´± Î²âŠ†Î²' Î¸â‚â‰ˆÎ¸â‚‚) pcâŠ‘A
  -- ... | Î²'' âˆ§ Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‰ˆâ€² , vâ‰ˆ âŸ© = Î²'' âˆ§ trans-âŠ† Î²âŠ†Î²' Î²'âŠ†Î²'' âˆ§ âŸ¨ Î¼â‰ˆâ€²â€² , Valueá´¸ pcâŠ‘A Unit âŸ©
  --   where câ‰ˆâ‚ = ? -- âŒ cellá´´ (trans-â‹¤ âŠ‘â‚ â„“â‚â‹¤A) (join-â‹¤â‚ â„“â‚â‹¤A) âŒŸ
  --         câ‰ˆâ‚‚ = ? -- âŒ cellá´´ (trans-â‹¤ âŠ‘â‚‚ â„“â‚‚â‹¤A) (join-â‹¤â‚ â„“â‚‚â‹¤A) âŒŸ
  --         Î¼â‰ˆâ€²â€² = square-â‰ˆá´´-Î¹ Î¼â‰ˆâ€² (writeá´´-â‰ˆá´´ {{ {!!} }} âˆˆâ‚ wâ‚ câ‰ˆâ‚) (writeá´´-â‰ˆá´´ {{ {!!} }} âˆˆâ‚‚ wâ‚‚ câ‰ˆâ‚‚)


  -- TINI for high steps. The computations depend on a secret and thus
  -- might produce different results and code. We then prove TINI by
  -- showing that the program counter can only remain secret and that
  -- each high step preserves low-equivalence of stores.  In
  -- particular we prove that the final stores are low-equivalent (Î¼â‚'
  -- â‰ˆ Î¼â‚‚'), i.e., the square:
  --
  -- Î¼â‚ â‰ˆá´´ Î¼â‚'
  -- â‰ˆá´´    â‰ˆá´´
  -- Î¼â‚‚ â‰ˆá´´ Î¼â‚‚'
  --
  -- using transitivity and symmetry of â‰ˆá´´
  -- TODO: do the same for FS-Store
  tiniá´´ : âˆ€ {Ï„ Î“â‚ Î“â‚‚ Î¸â‚ Î¸â‚‚ pcâ‚ pcâ‚‚ Î²} {câ‚ : IConf Î“â‚ Ï„} {câ‚‚ : IConf Î“â‚‚ Ï„} {câ‚' câ‚‚' : FConf Ï„} â†’
             let âŸ¨ Î£â‚ , Î¼â‚ , _ âŸ© = câ‚
                 âŸ¨ Î£â‚‚ , Î¼â‚‚ , _ âŸ© = câ‚‚ in
             -- {{validâ‚á´µ : Validá´µ câ‚}} {{validá´± : Validá´± âˆ¥ Î¼â‚ âˆ¥ Î¸â‚}} â†’
             -- {{validâ‚‚á´µ : Validá´µ câ‚‚}} {{validâ‚‚á´± : Validá´± âˆ¥ Î¼â‚‚ âˆ¥ Î¸â‚‚}} â†’
             {{validâ‚ : Valid-Inputs câ‚ Î¸â‚}} {{validâ‚‚ : Valid-Inputs câ‚‚ Î¸â‚‚}} â†’
             âŸ¨ Î£â‚ , Î¼â‚ âŸ© â‰ˆâŸ¨ Î² âŸ©á´¾ âŸ¨ Î£â‚‚ , Î¼â‚‚ âŸ© â†’
             câ‚ â‡“âŸ¨ Î¸â‚ , pcâ‚ âŸ© câ‚' â†’
             câ‚‚ â‡“âŸ¨ Î¸â‚‚ , pcâ‚‚ âŸ© câ‚‚' â†’
             pcâ‚ â‹¤ A â†’ pcâ‚‚ â‹¤ A â†’
             âˆƒ (Î» Î²' â†’ Î² âŠ† Î²' Ã— câ‚' â‰ˆâŸ¨ Î²' âŸ©á¶œ câ‚‚')
  -- Do we actually need to prove Î² âŠ† Î²' ? Not clear from Banjaree proof if this is ever used.
  -- The only reason I can think of is that the theorem might be trivial if we choose Î²' = âˆ…
  -- because we do not need to take care of the references. Check this with Deepak.
  tiniá´´ {Î² = Î²} {{âŸ¨ âŸ¨ _ , isVâ‚á´´ âŸ© , isVâ‚á´± âŸ© }} {{âŸ¨ âŸ¨ _ , isVâ‚‚á´´ âŸ© , isVâ‚‚á´± âŸ© }}
         Î¼â‚â‰ˆÎ¼â‚‚ xâ‚ xâ‚‚ pcâ‚â‹¤A pcâ‚‚â‹¤A =
    let Î¼â‚â‰ˆÎ¼â‚' = step-â‰ˆá´´ {{ {!!} }} {{ isVâ‚á´± }} xâ‚ pcâ‚â‹¤A
        Î¼â‚‚â‰ˆÎ¼â‚‚' = step-â‰ˆá´´ {{ {!!} }} {{ isVâ‚‚á´± }} xâ‚‚ pcâ‚‚â‹¤A
        Î¼â‚'â‰ˆÎ¼â‚‚' = square-â‰ˆá´¾-Î¹ Î¼â‚â‰ˆÎ¼â‚‚ Î¼â‚â‰ˆÎ¼â‚' Î¼â‚‚â‰ˆÎ¼â‚‚'
        vâ‰ˆ = Valueá´´ (trans-â‹¤ (step-âŠ‘ xâ‚) pcâ‚â‹¤A) (trans-â‹¤ (step-âŠ‘ xâ‚‚) pcâ‚‚â‹¤A) in
        Î² âˆ§ B.refl-âŠ† âˆ§ âŸ¨ Î¼â‚'â‰ˆÎ¼â‚‚' , vâ‰ˆ âŸ©


  -- TINI: top level theorem
  tini : âˆ€ {Ï„ Î“ Î¸â‚ Î¸â‚‚ pc Î²} {câ‚ câ‚‚ : IConf Î“ Ï„} {câ‚' câ‚‚' : FConf Ï„} â†’
             -- {{validâ‚á´µ : Validá´µ câ‚}} {{validá´± : Validá´± âˆ¥ store câ‚ âˆ¥ Î¸â‚}} â†’
             -- {{validâ‚‚á´µ : Validá´µ câ‚‚}} {{validâ‚‚á´± : Validá´± âˆ¥ store câ‚‚ âˆ¥ Î¸â‚‚}} â†’
             {{validâ‚ : Valid-Inputs câ‚ Î¸â‚}} {{validâ‚‚ : Valid-Inputs câ‚‚ Î¸â‚‚}} â†’
             câ‚ â‡“âŸ¨ Î¸â‚ , pc âŸ© câ‚' â†’
             câ‚‚ â‡“âŸ¨ Î¸â‚‚ , pc âŸ© câ‚‚' â†’
             câ‚ â‰ˆâŸ¨ Î² âŸ©á´µ câ‚‚ â†’
             Î¸â‚ â‰ˆâŸ¨ Î² âŸ©á´± Î¸â‚‚ â†’
             âˆƒ (Î» Î²' â†’ Î² âŠ† Î²' Ã— câ‚' â‰ˆâŸ¨ Î²' âŸ©á¶œ câ‚‚')
  tini {pc = pc} xâ‚ xâ‚‚ âŸ¨ Î¼â‚â‰ˆÎ¼â‚‚ , refl âŸ©  Î¸â‚â‰ˆÎ¸â‚‚ with pc âŠ‘? A
  ... | yes pcâŠ‘A = tiniá´¸ xâ‚ xâ‚‚ Î¼â‚â‰ˆÎ¼â‚‚ Î¸â‚â‰ˆÎ¸â‚‚ pcâŠ‘A
  ... | no pcâ‹¤A = tiniá´´ Î¼â‚â‰ˆÎ¼â‚‚ xâ‚ xâ‚‚ pcâ‹¤A pcâ‹¤A
